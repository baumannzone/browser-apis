<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Demo - IO Extended</title>
</head>

<body>

<h1>Demo BT:</h1>

<button id="button">Click me</button>

<div id="output"></div>

<script>
  const output = document.getElementById('output')
  const button = document.getElementById('button')

  function demoBattery() {
    navigator.getBattery()
        .then((battery) => {
          console.log('battery:')
          console.log(battery)
          battery.addEventListener('onchargingchange', onchargingchange(battery))
          battery.addEventListener("onlevelchange", onlevelchange(battery))
        })

    function onlevelchange(battery) {
      console.log('Battery status: ' + battery.level * 100 + ' %')
    }

    function onchargingchange(battery) {
      if (battery.charging) {
        console.log("Battery is charging")
      }
    }
  }

  function demoGeoLocation() {
    if ("geolocation" in navigator) {
      /* geolocalizaciÃ³n disponible */
      console.log('Loading position...')
      navigator.geolocation.getCurrentPosition(position => {
        console.log('Position:')
        console.log(position.coords)

        const latitude = position.coords.latitude
        const longitude = position.coords.longitude

        output.innerHTML = '<p>Latitude is ' + latitude + 'Â° <br>Longitude is ' + longitude + 'Â°</p>'

        const url = `https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=8e456d1b8c004a1384e71d9a6c97e94f`

        fetch(url)
            .then(response => response.json())
            .then((res) => {
              console.log('External Â· Geo API:')
              console.log(res.results[0].formatted)
              console.log(res.results[0].components)
              // console.log(res.results[0].components.country)
              // console.log(res.results[0].components.state)
              // console.log(res.results[0].components.county)
              // console.log(res.results[0].components.city)
            })

      }, error => console.error(error))
    } else {
      console.log('GEO no disponible')
      /* geolocalizaciÃ³n NO disponible */
    }
  }

  function demoVibration() {
    /**
     * The vibrate API is only available once the user has started interacting with your page
     * (e.g, by tapping or dragging on the screen).
     * It cannot be used before a user interaction
     * this is to prevent web pages (particularly embedded advertisements!)
     * from attempting to scare the user by making their phone vibrate.
     */

    output.innerHTML = '<p>!!!</p>'
    // if (!('vibrate' in navigator) && ('ontouchstart' in window)) {
    //   return false
    // }
    if ('vibrate' in navigator) {
      output.innerHTML = '<p>Vamos a vibrar...</p>'
      navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate
      navigator.vibrate([200, 100, 200, 100, 200, 100, 200])
      navigator.vibrate(400)
    }
  }

  function demoBluetooth() {
    console.log('Bluetooth...')

    /**
     * As a security feature, discovering Bluetooth devices with navigator.bluetooth.requestDevice
     * must be triggered by a user gesture such as a touch or a mouse click.
     * We're talking about listening to pointerup, click, and touchend events.
     */

    const options = {
      filters: [
        {services: ['heart_rate']},
        {services: [0x1802, 0x1803]},
        {services: ['c48e6067-5295-48d3-8d5c-0395f61792b1']},
        {name: 'ExampleName'},
        {namePrefix: 'Prefix'}
      ],
      optionalServices: ['battery_service']
    }
    const all = {
      acceptAllDevices: true
    }

    // navigator.bluetooth.requestDevice({filters: [{services: ['battery_service']}]})
    //     .then(device => {
    //       output.innerHTML = '<p>' + JSON.stringify(device) + '</p>'
    //     })
    //     .catch(error => {
    //       console.log(error)
    //     })

    // navigator.bluetooth.requestDevice(all)
    //     .then((device) => {
    //       console.log('Name: ' + device.name)
    //       console.log(device)
    //       output.innerHTML = '<p>' + device.name + '</p>'
    //       device.gatt.connect()
    //     })
    //     .catch((error) => {
    //       console.log("Something went wrong. " + error)
    //       output.innerHTML = '<p>' + error + '</p>'
    //     })
    // }

    const bat = {
      filters: [
        {services: ['battery_service']}
      ]
    }
    navigator.bluetooth.requestDevice(bat)
        .then((device) => {
          output.innerHTML = '<h3>' + device.name + '</h3>'
          return device.gatt.connect()
        })
        .then((server) => {
          // Getting Battery Service...
          console.log(server)
          return server.getPrimaryService('battery_service')
        })
        .then((service) => {
          // Getting Battery Level Characteristic...
          console.log(service)
          return service.getCharacteristic('battery_level')
        })
        .then((characteristic) => {
          // Reading Battery Level...
          console.log(characteristic)
          return characteristic.readValue()
        })
        .then(value => {
          console.log(value)
          console.log('Battery percentage is ' + value.getUint8(0))
        })
        .catch(error => {
          console.log(error)
          output.innerHTML = '<p>' + error + '</p>'
        })
  }

  function demoAudio() {
    console.log('Audio...')
    const ac = new AudioContext()
    const oscillator = ac.createOscillator()
    // oscillator.type = 'sawtooth'
    oscillator.connect(ac.destination)

    const time = ac.currentTime
    oscillator.frequency.value = 400
    oscillator.start(time)
    oscillator.stop(time + 0.5)

    // It sounds twice
    oscillator.onended = function () {
      console.log('Termine de sonar')
      if (this.frequency.value === 400) {
        const ac = new AudioContext()
        const oscillator = ac.createOscillator()
        const time = ac.currentTime
        oscillator.connect(ac.destination)
        oscillator.frequency.value = 500
        oscillator.start(time)
        oscillator.stop(time + 0.5)
      }
    }

    // A string which specifies the shape of waveform to play;
    // this can be one of a number of standard values, or custom to use a PeriodicWave to describe a custom waveform.
    // Different waves will produce different tones. Standard values are "sine", "square", "sawtooth", "triangle" and "custom".
    // The default is "sine".
  }

  function demoNotifications() {
    Notification.requestPermission()
        .then((permission) => {
          console.log('permission')
          console.log(permission) // granted / denied
          if (permission === 'granted') {
            // Permission granted!
            const noti = new Notification('ðŸ˜ ðŸ˜  3hs. probando!', {body: 'TenÃ­a el modo no molestar', icon: 'data:image/png;base64,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'})
          }
        })
  }

  // demoBattery()
  // demoGeoLocation()
  // button.addEventListener('click', demoVibration)
  // button.addEventListener('click', demoBluetooth)
  // button.addEventListener('click', demoAudio)

  button.addEventListener('click', demoNotifications)

</script>

</body>
</html>
