<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

<h1>Demo</h1>
<button id="button">Click me</button>
<div id="output"></div>

<script>
  const output = document.getElementById('output')
  const button = document.getElementById('button')

  function demoBattery() {
    navigator.getBattery()
        .then((battery) => {
          console.log('battery:')
          console.log(battery)
          battery.addEventListener('onchargingchange', onchargingchange(battery))
          battery.addEventListener("onlevelchange", onlevelchange(battery))
        })

    function onlevelchange(battery) {
      console.log('Battery status: ' + battery.level * 100 + ' %')
    }

    function onchargingchange(battery) {
      if (battery.charging) {
        console.log("Battery is charging")
      }
    }
  }

  function demoGeoLocation() {
    if ("geolocation" in navigator) {
      /* geolocalización disponible */
      console.log('Loading position...')
      navigator.geolocation.getCurrentPosition(position => {
        console.log('Position:')
        console.log(position.coords)

        const latitude = position.coords.latitude
        const longitude = position.coords.longitude

        output.innerHTML = '<p>Latitude is ' + latitude + '° <br>Longitude is ' + longitude + '°</p>'

        const url = `https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=8e456d1b8c004a1384e71d9a6c97e94f`

        fetch(url)
            .then(response => response.json())
            .then((res) => {
              console.log('External · Geo API:')
              console.log(res.results[0].formatted)
              console.log(res.results[0].components)
              // console.log(res.results[0].components.country)
              // console.log(res.results[0].components.state)
              // console.log(res.results[0].components.county)
              // console.log(res.results[0].components.city)
            })

      }, error => console.error(error))
    } else {
      console.log('GEO no disponible')
      /* geolocalización NO disponible */
    }
  }

  function demoVibration() {
    /**
     * The vibrate API is only available once the user has started interacting with your page
     * (e.g, by tapping or dragging on the screen).
     * It cannot be used before a user interaction
     * this is to prevent web pages (particularly embedded advertisements!)
     * from attempting to scare the user by making their phone vibrate.
     */

    output.innerHTML = '<p>!!!</p>'
    // if (!('vibrate' in navigator) && ('ontouchstart' in window)) {
    //   return false
    // }
    if ('vibrate' in navigator) {
      output.innerHTML = '<p>Vamos a vibrar...</p>'
      navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate
      navigator.vibrate([200, 100, 200, 100, 200, 100, 200])
      navigator.vibrate(400)
    }
  }

  function demoBluetooth() {

    /**
     * As a security feature, discovering Bluetooth devices with navigator.bluetooth.requestDevice
     * must be triggered by a user gesture such as a touch or a mouse click.
     * We're talking about listening to pointerup, click, and touchend events.
     */

    const options = {
      filters: [
        {services: ['heart_rate']},
        {services: [0x1802, 0x1803]},
        {services: ['c48e6067-5295-48d3-8d5c-0395f61792b1']},
        {name: 'ExampleName'},
        {namePrefix: 'Prefix'}
      ],
      optionalServices: ['battery_service']
    }
    const all = {
      acceptAllDevices: true
    }

    navigator.bluetooth.requestDevice(all)
        .then((device) => {
          console.log('Name: ' + device.name)
          console.log(device)
          output.innerHTML = '<p>'+device.toString()+'</p>'
        })
        .catch((error) => {
          console.log("Something went wrong. " + error)
          output.innerHTML = '<p>'+ error +'</p>'
        })
  }

  // demoBattery()
  // demoGeoLocation()
  // button.addEventListener('click', demoVibration)
  button.addEventListener('click', demoBluetooth)


</script>

</body>
</html>
